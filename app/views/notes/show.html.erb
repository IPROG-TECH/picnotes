<div class = 'show-page-container'>
  <div class = 'show-page-tab'>
    <div class = 'show-page-tab-left'>
      <h5 class = 'modal-title'> <%= @note.title %> </h5>
      <p>
        <% if user_signed_in? && can?(:favorite, @note)%>
          <% unless current_user.favorited_notes.exists?(id: @note.id) %>
            <span class = 'favorites-count'> <%= link_to fa_icon('heart-o'), favorite_notes_path(note_id: @note), remote:true, method: :post %> <%= @note.favorites.count %> </span>
          <% else %>
            <span class = 'favorites-count'> <%= link_to fa_icon('heart'), favorite_note_path(@note), remote:true, method: :delete %> <%= @note.favorites.count %> </span>
          <% end %>
        <% else %>
          <%= fa_icon('heart') %> <%= @note.favorites.count %>
        <% end %>
      </p>
    </div>

    <div class = 'show-page-tab-right'>
      <div>
        <p> <%= link_to @note.user.username, user_path(@note.user), class: 'no-look-btn' %> </p>
        <p>
          <%= @note.created_at.strftime("%m/%d/%Y") %>
          <% if user_signed_in? && can?(:crud, @note) %>
            <button
              type = 'button'
              class = 'no-look-btn'
              data-toggle = 'modal'
              data-target = '#editNoteModal'
              data-whatever = '@mdo'
              data-dismiss="modal">
              Edit
            </button>
            <%= link_to('Delete', note_path(@note), class: 'no-look-btn', data: {confirm: 'Are you sure?'}, method: :delete) %>
          <% end %>
        </p>
      </div>
      <div>
        <% if @note.user.avatar? %>
          <%= image_tag @note.user.avatar.url(:thumb), class: 'avatar-image' %>
        <% else %>
          <%= image_tag 'avatar.png', class: 'avatar-image' %>
        <% end %>
      </div>
    </div>
  </div>

  <div class = 'note-page-content'>
    <div class = 'note-mobile-image'>
      <% if @note.image.present? %>
      <%= image_tag @note.image.url(:large), class:"note-image" %>
      <% end %>
    </div>

    <div class = 'note-page-text' style = "width: 100%">
      <div class = 'tab'>
        <button class = 'tablinks' onclick = 'openTab(event, "show-information")' id = 'defaultingOpen'> Information </button>
        <button class = 'tablinks' onclick = 'openTab(event, "show-references")'> Study Guide </button>
      </div>

      <div class = 'notes-overflow'>
        <div id = 'show-information' class = 'tabcontent'>
          <p class = "note-page-content-text"> <%= @note.body %> </p>
          <p> Tags: <%= render @note.tags %></p>
        </div>

        <div id = 'show-references' class = 'tabcontent'>
          <div class="select-board">
            <p>Choose your board</p>
            <%= form_tag(note_path(@note, remote: true), {:method => 'get'}) do |f| %>
                <select name="board_id" id="board_id">

                    <!-- Select a board -->
                    <option value="" <%= !@board ? "selected" : "" %>>SELECT A board</option>

                    <% @boards.each do |w| %>
                        <option value="<%=w.id %>" <%= "#{w.id}" === @board ? "selected" : "" %>><%=w.name%></option>
                    <% end %>
                </select>

                <%= submit_tag('Update', :name => nil, :class => 'no-look-btn') %>
            <% end %>
            <% if @board %>
              <p> Add to <%= @board.name %>? </p>
              <%= form_tag(toggle_board_note_url(@user, @board), remote: true) do |f| %>
                  <%= hidden_field_tag :board_id, @board.id %>
                  <%= hidden_field_tag :note_id, @note.id %>

                  <!-- Button: Add or Remove item from list -->
                  <%= button_tag(@board.has_note?(@note)? "Remove from Board" : "Add to Board", :class => 'no-look-btn') %>
              <% end %>
            <% end %>
          </div>

          <hr>
          <%= render @note.references %>
          <!-- <% @references.each do |reference| %>
            <p> <%= reference.title %> | <%= reference.author %> | <a href = 'https://<%= reference.link %>'> <%= reference.link %> </a> </p>
          <% end %> -->
          <% if current_user %>
            <% if current_user.username == @note.user.username %>
              <%= simple_form_for([@note, @reference], remote: true) do |f| %>
                <div>
                  <%= f.input :title %>
                  <%= f.input :author %>
                  <%= f.input :link %>
                </div>
                <%= f.submit class: 'no-look-btn' %>
              <% end %>
            <% end %>
          <% end %>
        </div>
      </div>

      <div class = 'like-container'>
        <% if user_signed_in? && can?(:like, @note) && can?(:dislike, @note) %>

          <%= link_to like_note_path(@note), remote: true, class: 'white-btn like-tab like-color', method: :put do %>
            <%= fa_icon('check') %> <span class = 'upvotes-count'><%= @note.get_upvotes.size %> </span>
          <% end %>

          <%= link_to dislike_note_path(@note), remote: true, class: 'white-btn like-tab dislike-color', method: :put do %>
            <%= fa_icon('times') %> <span class = 'downvotes-count'><%= @note.get_downvotes.size %> </span>
          <% end %>
        <% else %>
          <div class = 'like-tab like-color'>
            <%= fa_icon('check') %> <%= @note.get_upvotes.size %>
          </div>
          <div class = 'like-tab dislike-color'>
            <%= fa_icon('times') %> <%= @note.get_downvotes.size %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<script>
  console.log('hi');
  var abc = document.getElementById("defaultingOpen")
  console.log(abc)

  document.getElementById("defaultingOpen").click();

  function openTab(evt, tabName) {
      // Declare all variables
      var i, tabcontent, tablinks;

      // Get all elements with class="tabcontent" and hide them
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
          tabcontent[i].style.display = "none";
      }

      // Get all elements with class="tablinks" and remove the class "active"
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
          tablinks[i].className = tablinks[i].className.replace(" active", "");
      }

      // Show the current tab, and add an "active" class to the button that opened the tab
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";
      console.log('hi');
  }
</script>

<%= render './modals/edit_note_modal' %>

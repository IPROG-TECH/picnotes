<script>
  document.getElementById("defaultOpen").click();

  function openTab(evt, tabName) {
      // Declare all variables
      var i, tabcontent, tablinks;

      // Get all elements with class="tabcontent" and hide them
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
          tabcontent[i].style.display = "none";
      }

      // Get all elements with class="tablinks" and remove the class "active"
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
          tablinks[i].className = tablinks[i].className.replace(" active", "");
      }

      // Show the current tab, and add an "active" class to the button that opened the tab
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";
  }
</script>

<div id="note-modal" class="modal fade" role="dialog">
  <div style = "display: flex; align-items: center;">
    <div style = 'flex-basis: 10%; text-align: center;'>
    <% if @previous_note %>
      <!-- <%= link_to truncate(@previous_note.title, length: 18), note_path(@previous_note), data: {toggle: 'modal', dismiss: 'modal'}, remote: true%> -->
      <%= link_to fa_icon('arrow-left 3x'), note_path(@previous_note), data: {toggle: 'modal', dismiss: 'modal'}, remote: true%>

    <% end %>
    </div>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <div class = 'modal-header-information'>
          <div class = 'modal-header-information-title'>
            <h5 class = 'modal-title' id = 'noteModalLabel'> <%= note.title %> </h5>
            <p>
              <% if user_signed_in? && can?(:favorite, @note)%>
                <% unless current_user.favorited_notes.exists?(id: @note.id) %>
                  <%= link_to fa_icon('heart-o'), favorite_notes_path(note_id: @note), method: :post %> <%= @note.favorites.count %>
                <% else %>
                  <%= link_to fa_icon('heart'), favorite_note_path(@note), method: :delete %> <%= @note.favorites.count %>
                <% end %>
              <% else %>
                <%= fa_icon('heart') %> <%= @note.favorites.count %>
              <% end %>
            </p>
          </div>

          <div class = 'modal-header-information-content'>
            <div>
              <p> <%= link_to note.user.username, user_path(note.user), class: 'no-look-btn' %> </p>
              <p>
                <%= note.created_at %>
                <% if user_signed_in? && can?(:crud, @note) %>
                  <button
                    type = 'button'
                    class = 'no-look-btn'
                    data-toggle = 'modal'
                    data-target = '#editNoteModal'
                    data-whatever = '@mdo'
                    data-dismiss="modal">
                    Edit
                  </button>
                  <%= link_to('Delete', note_path(@note), class: 'no-look-btn', data: {confirm: 'Are you sure?'}, method: :delete) %>
                <% end %>
              </p>
            </div>
            <% if note.user.avatar? %>
              <%= image_tag note.user.avatar.url(:thumb), class: 'avatar-image' %>
            <% else %>
              <%= image_tag 'avatar.png', class: 'avatar-image' %>
            <% end %>
          </div>
        </div>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <div>
        <div class = "note-page-content">
          <div>
            <p> <%= image_tag @note.image.url(:large) if @note.image.present? %></p>


            <div class="select-board">
              <p>Choose your board</p>
              <%= form_tag(note_path(@note, remote: true), {:method => 'get'}) do |f| %>
                  <select name="board_id" id="board_id">

                      <!-- Select a board -->
                      <option value="" <%= !@board ? "selected" : "" %>>SELECT A board</option>

                      <% @boards.each do |w| %>
                          <option value="<%=w.id %>" <%= "#{w.id}" === @board ? "selected" : "" %>><%=w.name%></option>
                      <% end %>
                  </select>

                  <%= submit_tag('Update', :name => nil) %>
              <% end %>
            </div>

          </div>

            <div style = "width: 100%">
              <div class = 'tab'>
                <button class = 'tablinks' onclick = 'openTab(event, "information")' id = 'defaultOpen'> Information </button>
                <button class = 'tablinks' onclick = 'openTab(event, "references")'> Study Guide </button>
              </div>

              <div class = 'notes-overflow'>
                <div id = 'information' class = 'tabcontent'>
                  <p class = "note-page-content-text"> <%= @note.body %> </p>
                </div>

                <div id = 'references' class = 'tabcontent'>
                  <%= render @note.references %>
                  <!-- <% @references.each do |reference| %>
                    <p> <%= reference.title %> | <%= reference.author %> | <a href = 'https://<%= reference.link %>'> <%= reference.link %> </a> </p>
                  <% end %> -->
                  <% if current_user %>
                    <% if current_user.username == @note.user.username %>
                      <%= simple_form_for([@note, @reference], remote: true) do |f| %>
                        <div>
                          <%= f.input :title %>
                          <%= f.input :author %>
                          <%= f.input :link %>
                        </div>
                        <%= f.submit %>
                      <% end %>
                    <% end %>
                  <% end %>
                </div>
              </div>

              <div class = 'like-container'>
                <p>
                  Likes: <%= @note.likes.count %> Dislikes: <%= @note.dislikes.count %>

                  <% if user_signed_in? && can?(:like, @note) && can?(:dislike, @note) %>
                    <% if @like.present? %>
                      <%= link_to 'Cancel', like_path(@like), method: :delete %>
                    <% elsif @dislike.present? %>
                      <%= link_to 'Cancel', dislike_path(@dislike), method: :delete %>
                    <% else %>
                      <%= link_to 'Like', note_likes_path(@note), method: :post %>
                      <%= link_to 'Dislike', note_dislikes_path(@note), method: :post %>
                    <% end %>
                  <% end %>
                </p>

                <p> Tags: <%= render @note.tags %></p>
              </div>
            </div>

            <!-- <div class = 'notes-overflow'>
              <p class = "note-page-content-text"> <%= @note.body %> </p>

              <% @references.each do |reference| %>
                <p> <%= reference.title %> | <%= reference.author %> | <%= reference.link %> </p>
              <% end %>

              <%= simple_form_for [@note, @reference] do |f| %>
                <div>
                  <%= f.input :title %>
                  <%= f.input :author %>
                  <%= f.input :link %>
                </div>
                <%= f.submit %>
              <% end %>
            </div> -->
        </div>
      </div>
    </div>
  </div>
    <div style = 'flex-basis: 10%; text-align: center;'>
      <% if @next_note %>
        <%= link_to fa_icon('arrow-right 3x'), note_path(@next_note), data: {toggle: 'modal', dismiss: 'modal'}, remote: true%>
        <% end %>
    </div>
  </div>
</div>

<%= render './modals/edit_note_modal' %>

/*!
 * froala_editor v3.2.2 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2020 Froala Labs
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("froala-editor")):"function"==typeof define&&define.amd?define(["froala-editor"],t):t(e.FroalaEditor)}(this,function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e=e&&e.hasOwnProperty("default")?e["default"]:e,Object.assign(e.POPUP_TEMPLATES,{"image.insert":"[_BUTTONS_][_UPLOAD_LAYER_][_BY_URL_LAYER_][_PROGRESS_BAR_]","image.edit":"[_BUTTONS_]","image.alt":"[_BUTTONS_][_ALT_LAYER_]","image.size":"[_BUTTONS_][_SIZE_LAYER_]"}),Object.assign(e.DEFAULTS,{imageInsertButtons:["imageBack","|","imageUpload","imageByURL"],imageEditButtons:["imageReplace","imageAlign","imageCaption","imageRemove","imageLink","linkOpen","linkEdit","linkRemove","-","imageDisplay","imageStyle","imageAlt","imageSize"],imageAltButtons:["imageBack","|"],imageSizeButtons:["imageBack","|"],imageUpload:!0,imageUploadURL:null,imageCORSProxy:"https://cors-anywhere.froala.com",imageUploadRemoteUrls:!0,imageUploadParam:"file",imageUploadParams:{},imageUploadToS3:!1,imageUploadToAzure:!1,imageUploadMethod:"POST",imageMaxSize:10485760,imageAllowedTypes:["jpeg","jpg","png","gif","webp"],imageResize:!0,imageResizeWithPercent:!1,imageRoundPercent:!1,imageDefaultWidth:300,imageDefaultAlign:"center",imageDefaultDisplay:"block",imageSplitHTML:!1,imageStyles:{"fr-rounded":"Rounded","fr-bordered":"Bordered","fr-shadow":"Shadow"},imageMove:!0,imageMultipleStyles:!0,imageTextNear:!0,imagePaste:!0,imagePasteProcess:!1,imageMinWidth:16,imageOutputSize:!1,imageDefaultMargin:5,imageAddNewLine:!1}),e.PLUGINS.image=function(a){function i(){var e=a.popups.get("image.insert").find(".fr-image-by-url-layer input");e.val(""),se&&e.val(se.attr("src")),e.trigger("change")}function n(){var e=a.popups.get("image.edit");if(e||(e=h()),e){var t=ne();re()&&(t=t.find(".fr-img-wrap")),a.popups.setContainer("image.edit",a.$sc),a.popups.refresh("image.edit");var i=t.offset().left+t.outerWidth()/2,n=t.offset().top+t.outerHeight();se.hasClass("fr-uploading")?v():a.popups.show("image.edit",i,n,t.outerHeight(),!0)}}function r(){b()}function o(e){0<e.parents(".fr-img-caption").length&&(e=e.parents(".fr-img-caption").first()),Q(e,e.hasClass("fr-dib")?"block":e.hasClass("fr-dii")?"inline":null,e.hasClass("fr-fil")?"left":e.hasClass("fr-fir")?"right":Z(e)),e.removeClass("fr-dib fr-dii fr-fir fr-fil")}function s(){for(var e,t="IMG"==a.el.tagName?[a.el]:a.el.querySelectorAll("img"),i=0;i<t.length;i++){var n=de(t[i]);!a.opts.htmlUntouched&&a.opts.useClasses?((a.opts.imageDefaultAlign||a.opts.imageDefaultDisplay)&&(0<(e=n).parents(".fr-img-caption").length&&(e=e.parents(".fr-img-caption").first()),e.hasClass("fr-dii")||e.hasClass("fr-dib")||(e.addClass("fr-fi".concat(Z(e)[0])),e.addClass("fr-di".concat(ee(e)[0])),e.css("margin",""),e.css("float",""),e.css("display",""),e.css("z-index",""),e.css("position",""),e.css("overflow",""),e.css("vertical-align",""))),a.opts.imageTextNear||(0<n.parents(".fr-img-caption").length?n.parents(".fr-img-caption").first().removeClass("fr-dii").addClass("fr-dib"):n.removeClass("fr-dii").addClass("fr-dib"))):a.opts.htmlUntouched||a.opts.useClasses||(a.opts.imageDefaultAlign||a.opts.imageDefaultDisplay)&&o(n),a.opts.iframe&&n.on("load",a.size.syncIframe)}}function l(e){void 0===e&&(e=!0);var t,i=Array.prototype.slice.call(a.el.querySelectorAll("img")),n=[];for(t=0;t<i.length;t++)if(n.push(i[t].getAttribute("src")),de(i[t]).toggleClass("fr-draggable",a.opts.imageMove),""===i[t].getAttribute("class")&&i[t].removeAttribute("class"),""===i[t].getAttribute("style")&&i[t].removeAttribute("style"),i[t].parentNode&&i[t].parentNode.parentNode&&a.node.hasClass(i[t].parentNode.parentNode,"fr-img-caption")){var r=i[t].parentNode.parentNode;a.browser.mozilla||r.setAttribute("contenteditable",!1),r.setAttribute("draggable",!1),r.classList.add("fr-draggable");var o=i[t].nextSibling;o&&!a.browser.mozilla&&o.setAttribute("contenteditable",!0)}if(ge)for(t=0;t<ge.length;t++)n.indexOf(ge[t].getAttribute("src"))<0&&a.events.trigger("image.removed",[de(ge[t])]);if(ge&&e){var s=[];for(t=0;t<ge.length;t++)s.push(ge[t].getAttribute("src"));for(t=0;t<i.length;t++)s.indexOf(i[t].getAttribute("src"))<0&&a.events.trigger("image.loaded",[de(i[t])])}ge=i}function p(){if(le||function(){var t;if(a.shared.$image_resizer?(le=a.shared.$image_resizer,fe=a.shared.$img_overlay,a.events.on("destroy",function(){de("body").first().append(le.removeClass("fr-active"))},!0)):(a.shared.$image_resizer=de(document.createElement("div")).attr("class","fr-image-resizer"),le=a.shared.$image_resizer,a.events.$on(le,"mousedown",function(e){e.stopPropagation()},!0),a.opts.imageResize&&(le.append(f("nw")+f("ne")+f("sw")+f("se")),a.shared.$img_overlay=de(document.createElement("div")).attr("class","fr-image-overlay"),fe=a.shared.$img_overlay,t=le.get(0).ownerDocument,de(t).find("body").first().append(fe))),a.events.on("shared.destroy",function(){le.html("").removeData().remove(),le=null,a.opts.imageResize&&(fe.remove(),fe=null)},!0),a.helpers.isMobile()||a.events.$on(de(a.o_win),"resize",function(){se&&!se.hasClass("fr-uploading")?q(!0):se&&(p(),te(),v(!1))}),a.opts.imageResize){t=le.get(0).ownerDocument,a.events.$on(le,a._mousedown,".fr-handler",c),a.events.$on(de(t),a._mousemove,d),a.events.$on(de(t.defaultView||t.parentWindow),a._mouseup,m),a.events.$on(fe,"mouseleave",m);var i=1,n=null,r=0;a.events.on("keydown",function(t){if(se){var o=-1!=navigator.userAgent.indexOf("Mac OS X")?t.metaKey:t.ctrlKey,s=t.which;(s!==n||200<t.timeStamp-r)&&(i=1),(s==e.KEYCODE.EQUALS||a.browser.mozilla&&s==e.KEYCODE.FF_EQUALS)&&o&&!t.altKey?i=_.call(this,t,1,1,i):(s==e.KEYCODE.HYPHEN||a.browser.mozilla&&s==e.KEYCODE.FF_HYPHEN)&&o&&!t.altKey?i=_.call(this,t,2,-1,i):a.keys.ctrlKey(t)||s!=e.KEYCODE.ENTER||(se.before("<br>"),A(se)),n=s,r=t.timeStamp}},!0),a.events.on("keyup",function(){i=1})}}(),!se)return!1;var t=a.$wp||a.$sc;t.append(le),le.data("instance",a);var i=t.scrollTop()-("static"!=t.css("position")?t.offset().top:0),n=t.scrollLeft()-("static"!=t.css("position")?t.offset().left:0);n-=a.helpers.getPX(t.css("border-left-width")),i-=a.helpers.getPX(t.css("border-top-width")),a.$el.is("img")&&a.$sc.is("body")&&(n=i=0);var r=ne();re()&&(r=r.find(".fr-img-wrap"));var o=0,s=0;a.opts.iframe&&(o=a.helpers.getPX(a.$wp.find(".fr-iframe").css("padding-top")),s=a.helpers.getPX(a.$wp.find(".fr-iframe").css("padding-left"))),le.css("top",(a.opts.iframe?r.offset().top+o:r.offset().top+i)-1).css("left",(a.opts.iframe?r.offset().left+s:r.offset().left+n)-1).css("width",r.get(0).getBoundingClientRect().width).css("height",r.get(0).getBoundingClientRect().height).addClass("fr-active")}function f(e){return'<div class="fr-handler fr-h'.concat(e,'"></div>')}function g(e){re()?se.parents(".fr-img-caption").css("width",e):se.css("width",e)}function c(e){if(!a.core.sameInstance(le))return!0;if(e.preventDefault(),e.stopPropagation(),a.$el.find("img.fr-error").left)return!1;a.undo.canDo()||a.undo.saveStep();var t=e.pageX||e.originalEvent.touches[0].pageX;if("mousedown"==e.type){var i=a.$oel.get(0).ownerDocument,n=i.defaultView||i.parentWindow,r=!1;try{r=n.location!=n.parent.location&&!(n.$&&n.$.FE)}catch(ge){}r&&n.frameElement&&(t+=a.helpers.getPX(de(n.frameElement).offset().left)+n.frameElement.clientLeft)}(pe=de(this)).data("start-x",t),pe.data("start-width",se.width()),pe.data("start-height",se.height());var o=se.width();if(a.opts.imageResizeWithPercent){var s=se.parentsUntil(a.$el,a.html.blockTagsQuery()).get(0)||a.el;o=(o/de(s).outerWidth()*100).toFixed(2)+"%"}g(o),fe.show(),a.popups.hideAll(),J()}function d(e){if(!a.core.sameInstance(le))return!0;var t;if(pe&&se){if(e.preventDefault(),a.$el.find("img.fr-error").left)return!1;var i=e.pageX||(e.originalEvent.touches?e.originalEvent.touches[0].pageX:null);if(!i)return!1;var n=i-pe.data("start-x"),r=pe.data("start-width");if((pe.hasClass("fr-hnw")||pe.hasClass("fr-hsw"))&&(n=0-n),a.opts.imageResizeWithPercent){var o=se.parentsUntil(a.$el,a.html.blockTagsQuery()).get(0)||a.el;r=((r+n)/de(o).outerWidth()*100).toFixed(2),a.opts.imageRoundPercent&&(r=Math.round(r)),g("".concat(r,"%")),(t=re()?(a.helpers.getPX(se.parents(".fr-img-caption").css("width"))/de(o).outerWidth()*100).toFixed(2):(a.helpers.getPX(se.css("width"))/de(o).outerWidth()*100).toFixed(2))===r||a.opts.imageRoundPercent||g("".concat(t,"%")),se.css("height","").removeAttr("height")}else r+n>=a.opts.imageMinWidth&&(g(r+n),t=re()?a.helpers.getPX(se.parents(".fr-img-caption").css("width")):a.helpers.getPX(se.css("width"))),t!==r+n&&g(t),((se.attr("style")||"").match(/(^height:)|(; *height:)/)||se.attr("height"))&&(se.css("height",pe.data("start-height")*se.width()/pe.data("start-width")),se.removeAttr("height"));p(),a.events.trigger("image.resize",[ie()])}}function m(e){if(!a.core.sameInstance(le))return!0;if(pe&&se){if(e&&e.stopPropagation(),a.$el.find("img.fr-error").left)return!1;pe=null,fe.hide(),p(),n(),a.undo.saveStep(),a.events.trigger("image.resizeEnd",[ie()])}else le.removeClass("fr-active")}function u(e,t,i){a.edit.on(),se&&se.addClass("fr-error"),Ce[e]?w(a.language.translate(Ce[e])):w(a.language.translate("Something went wrong. Please try again.")),!se&&i&&M(i),a.events.trigger("image.error",[{code:e,message:Ce[e]},t,i])}function h(e){if(e)return a.$wp&&a.events.$on(a.$wp,"scroll.image-edit",function(){se&&a.popups.isVisible("image.edit")&&(a.events.disableBlur(),n())}),!0;var t="";if(0<a.opts.imageEditButtons.length){var i={buttons:t+='<div class="fr-buttons"> \n        '.concat(a.button.buildList(a.opts.imageEditButtons),"\n        </div>")};return a.popups.create("image.edit",i)}return!1}function v(e){var t=a.popups.get("image.insert");if(t||(t=I()),t.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),t.find(".fr-image-progress-bar-layer").addClass("fr-active"),t.find(".fr-buttons").hide(),se){var i=ne();a.popups.setContainer("image.insert",a.$sc);var n=i.offset().left,r=i.offset().top+i.height();a.popups.show("image.insert",n,r,i.outerHeight())}void 0===e&&y(a.language.translate("Uploading"),0)}function b(e){var t=a.popups.get("image.insert");if(t&&(t.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),t.find(".fr-image-progress-bar-layer").removeClass("fr-active"),t.find(".fr-buttons").show(),e||a.$el.find("img.fr-error").length)){if(a.events.focus(),a.$el.find("img.fr-error").length&&(a.$el.find("img.fr-error").remove(),a.undo.saveStep(),a.undo.run(),a.undo.dropRedo()),!a.$wp&&se){var i=se;q(!0),a.selection.setAfter(i.get(0)),a.selection.restore()}a.popups.hide("image.insert")}}function y(e,t){var i=a.popups.get("image.insert");if(i){var n=i.find(".fr-image-progress-bar-layer");n.find("h3").text(e+(t?" ".concat(t,"%"):"")),n.removeClass("fr-error"),t?(n.find("div").removeClass("fr-indeterminate"),n.find("div > span").css("width","".concat(t,"%"))):n.find("div").addClass("fr-indeterminate")}}function w(e){v();var t=a.popups.get("image.insert").find(".fr-image-progress-bar-layer");t.addClass("fr-error");var i=t.find("h3");i.text(e),a.events.disableBlur(),i.focus()}function A(e){F.call(e.get(0))}function C(){var e=de(this);a.popups.hide("image.insert"),e.removeClass("fr-uploading"),e.next().is("br")&&e.next().remove(),A(e),a.events.trigger("image.loaded",[e])}function S(e,t,i,n,r){n&&"string"==typeof n&&(n=a.$(n)),a.edit.off(),y(a.language.translate("Loading image")),t&&(e=a.helpers.sanitizeURL(e));var o=new Image;o.onload=function(){var t,o;if(n){a.undo.canDo()||n.hasClass("fr-uploading")||a.undo.saveStep();var s=n.data("fr-old-src");n.data("fr-image-pasted")&&(s=null),a.$wp?((t=n.clone().removeData("fr-old-src").removeClass("fr-uploading").removeAttr("data-fr-image-pasted")).off("load"),s&&n.attr("src",s),n.replaceWith(t)):t=n;for(var p=t.get(0).attributes,f=0;f<p.length;f++){var g=p[f];0===g.nodeName.indexOf("data-")?t.removeAttr(g.nodeName):i&&i.hasOwnProperty(g.nodeName)&&t.removeAttr(g.nodeName)}if(void 0!==i)for(o in i)i.hasOwnProperty(o)&&"link"!=o&&t.attr("".concat(o),i[o]);t.on("load",C),t.attr("src",e),a.edit.on(),l(!1),a.undo.saveStep(),a.events.disableBlur(),a.$el.blur(),a.events.trigger(s?"image.replaced":"image.inserted",[t,r])}else t=x(e,i,C),l(!1),a.undo.saveStep(),a.events.disableBlur(),a.$el.blur(),a.events.trigger("image.inserted",[t,r])},o.onerror=function(){u(he)},v(a.language.translate("Loading image")),o.src=e}function E(e,t,n){y(a.language.translate("Loading image"));var r=this.status,o=this.response,s=this.responseXML,l=this.responseText;try{if(a.opts.imageUploadToS3||a.opts.imageUploadToAzure)if(201==r){var p;if(a.opts.imageUploadToAzure){if(!1===a.events.trigger("image.uploadedToAzure",[this.responseURL,n,o],!0))return a.edit.on(),!1;p=t}else p=function(e){try{var t=de(e).find("Location").text(),i=de(e).find("Key").text();return!1===a.events.trigger("image.uploadedToS3",[t,i,e],!0)?(a.edit.on(),!1):t}catch(r){return u(ye,e),!1}}(s);p&&S(p,!1,[],e,o||s)}else u(ye,o||s,e);else if(200<=r&&r<300){var f=function(e){try{if(!1===a.events.trigger("image.uploaded",[e],!0))return a.edit.on(),!1;var t=JSON.parse(e);return t.link?t:(u(ve,e),!1)}catch(n){return u(ye,e),!1}}(l);f&&S(f.link,!1,f,e,o||l)}else u(be,o||l,e)}catch(i){u(ye,o||l,e)}}function R(){u(ye,this.response||this.responseText||this.responseXML)}function U(e){if(e.lengthComputable){var t=e.loaded/e.total*100|0;y(a.language.translate("Uploading"),t)}}function x(e,t,i){var n,r=de(document.createElement("img")).attr("src",e);if(t&&void 0!==t)for(n in t)t.hasOwnProperty(n)&&"link"!=n&&(" data-".concat(n,'="').concat(t[n],'"'),r.attr("".concat(n),t[n]));var o=a.opts.imageDefaultWidth;o&&"auto"!=o&&(o=a.opts.imageResizeWithPercent?"100%":"".concat(o,"px")),r.attr("style",o?"width: ".concat(o,";"):""),Q(r,a.opts.imageDefaultDisplay,a.opts.imageDefaultAlign),r.on("load",i),r.on("error",i),a.edit.on(),a.events.focus(!0),a.selection.restore(),a.undo.saveStep(),a.opts.imageSplitHTML?a.markers.split():a.markers.insert(),a.html.wrap();var s=a.$el.find(".fr-marker");return s.length?(s.parent().is("hr")&&s.parent().after(s),a.node.isLastSibling(s)&&s.parent().hasClass("fr-deletable")&&s.insertAfter(s.parent()),s.replaceWith(r)):a.$el.append(r),a.selection.clear(),r}function D(){a.edit.on(),b(!0)}function T(e,t){if(void 0!==e&&0<e.length){if(!1===a.events.trigger("image.beforeUpload",[e,t]))return!1;var i,n=e[0];if(!(null!==a.opts.imageUploadURL&&a.opts.imageUploadURL!=me||a.opts.imageUploadToS3||a.opts.imageUploadToAzure))return function(e,t){var i=new FileReader;i.onload=function(){var n=i.result;if(i.result.indexOf("svg+xml")<0){for(var r=atob(i.result.split(",")[1]),o=[],s=0;s<r.length;s++)o.push(r.charCodeAt(s));n=window.URL.createObjectURL(new Blob([new Uint8Array(o)],{type:e.type})),t&&t.data("fr-old-src",t.attr("src")),a.image.insert(n,!1,null,t)}},v(),i.readAsDataURL(e)}(n,t||se),!1;if(n.name||(n.name=(new Date).getTime()+"."+(n.type||"image/jpeg").replace(/image\//g,"")),n.size>a.opts.imageMaxSize)return u(we),!1;if(a.opts.imageAllowedTypes.indexOf(n.type.replace(/image\//g,""))<0)return u(Ae),!1;if(a.drag_support.formdata&&(i=a.drag_support.formdata?new FormData:null),i){var r;if(!1!==a.opts.imageUploadToS3)for(r in i.append("key",a.opts.imageUploadToS3.keyStart+(new Date).getTime()+"-"+(n.name||"untitled")),i.append("success_action_status","201"),i.append("X-Requested-With","xhr"),i.append("Content-Type",n.type),a.opts.imageUploadToS3.params)a.opts.imageUploadToS3.params.hasOwnProperty(r)&&i.append(r,a.opts.imageUploadToS3.params[r]);for(r in a.opts.imageUploadParams)a.opts.imageUploadParams.hasOwnProperty(r)&&i.append(r,a.opts.imageUploadParams[r]);i.append(a.opts.imageUploadParam,n,n.name);var o,s,l=a.opts.imageUploadURL,f=a.opts.imageUploadMethod;a.opts.imageUploadToS3&&(l=a.opts.imageUploadToS3.uploadURL?a.opts.imageUploadToS3.uploadURL:"https://".concat(a.opts.imageUploadToS3.region,".amazonaws.com/").concat(a.opts.imageUploadToS3.bucket)),a.opts.imageUploadToAzure&&(o=l=a.opts.imageUploadToAzure.uploadURL?"".concat(a.opts.imageUploadToAzure.uploadURL,"/").concat(n.name):encodeURI("https://".concat(a.opts.imageUploadToAzure.account,".blob.core.windows.net/").concat(a.opts.imageUploadToAzure.container,"/").concat(n.name)),a.opts.imageUploadToAzure.SASToken&&(l+=a.opts.imageUploadToAzure.SASToken),f="PUT");var g=a.core.getXHR(l,f);if(a.opts.imageUploadToAzure){var c=(new Date).toUTCString();if(!a.opts.imageUploadToAzure.SASToken&&a.opts.imageUploadToAzure.accessKey){var d=a.opts.imageUploadToAzure.account,m=a.opts.imageUploadToAzure.container;if(a.opts.imageUploadToAzure.uploadURL){var h=a.opts.imageUploadToAzure.uploadURL.split("/");m=h.pop(),d=h.pop().split(".")[0]}var b="x-ms-blob-type:BlockBlob\nx-ms-date:".concat(c,"\nx-ms-version:2019-07-07"),y=encodeURI("/"+d+"/"+m+"/"+n.name),w=f+"\n\n\n"+n.size+"\n\n"+n.type+"\n\n\n\n\n\n\n"+b+"\n"+y,C=a.cryptoJSPlugin.cryptoJS.HmacSHA256(w,a.cryptoJSPlugin.cryptoJS.enc.Base64.parse(a.opts.imageUploadToAzure.accessKey)).toString(a.cryptoJSPlugin.cryptoJS.enc.Base64),S="SharedKey "+d+":"+C;s=C,g.setRequestHeader("Authorization",S)}for(r in g.setRequestHeader("x-ms-version","2019-07-07"),g.setRequestHeader("x-ms-date",c),g.setRequestHeader("Content-Type",n.type),g.setRequestHeader("x-ms-blob-type","BlockBlob"),a.opts.imageUploadParams)a.opts.imageUploadParams.hasOwnProperty(r)&&g.setRequestHeader(r,a.opts.imageUploadParams[r]);for(r in a.opts.imageUploadToAzure.params)a.opts.imageUploadToAzure.params.hasOwnProperty(r)&&g.setRequestHeader(r,a.opts.imageUploadToAzure.params[r])}!function(e,t,i,n,r,o){function s(){var s=de(this);s.off("load"),s.addClass("fr-uploading"),s.next().is("br")&&s.next().remove(),a.placeholder.refresh(),A(s),p(),v(),a.edit.off(),e.onload=function(){E.call(e,s,r,o)},e.onerror=R,e.upload.onprogress=U,e.onabort=D,de(s.off("abortUpload")).on("abortUpload",function(){4!=e.readyState&&(e.abort(),n?(n.attr("src",n.data("fr-old-src")),n.removeClass("fr-uploading")):s.remove(),q(!0))}),e.send(a.opts.imageUploadToAzure?i:t)}var l=new FileReader;l.onload=function(){var e=l.result;if(l.result.indexOf("svg+xml")<0){for(var t=atob(l.result.split(",")[1]),i=[],r=0;r<t.length;r++)i.push(t.charCodeAt(r));e=window.URL.createObjectURL(new Blob([new Uint8Array(i)],{type:"image/jpeg"}))}n?(n.on("load",s),n.on("error",function(){s(),de(this).off("error")}),a.edit.on(),a.undo.saveStep(),n.data("fr-old-src",n.attr("src")),n.attr("src",e)):x(e,null,s)},l.readAsDataURL(i)}(g,i,n,t||se,o,s)}}}function $(e){if(e.is("img")&&0<e.parents(".fr-img-caption").length)return e.parents(".fr-img-caption")}function P(t){var i=t.originalEvent.dataTransfer;if(i&&i.files&&i.files.length){var n=i.files[0];if(n&&n.type&&-1!==n.type.indexOf("image")&&0<=a.opts.imageAllowedTypes.indexOf(n.type.replace(/image\//g,""))){if(!a.opts.imageUpload)return t.preventDefault(),t.stopPropagation(),!1;a.markers.remove(),a.markers.insertAtPoint(t.originalEvent),a.$el.find(".fr-marker").replaceWith(e.MARKERS),0===a.$el.find(".fr-marker").length&&a.selection.setAtEnd(a.el),a.popups.hideAll();var r=a.popups.get("image.insert");r||(r=I()),a.popups.setContainer("image.insert",a.$sc);var o=t.originalEvent.pageX,s=t.originalEvent.pageY;if(a.opts.iframe){var l=a.helpers.getPX(a.$wp.find(".fr-iframe").css("padding-top")),p=a.helpers.getPX(a.$wp.find(".fr-iframe").css("padding-left"));s+=a.$iframe.offset().top+l,o+=a.$iframe.offset().left+p}return a.popups.show("image.insert",o,s),v(),0<=a.opts.imageAllowedTypes.indexOf(n.type.replace(/image\//g,""))?(q(!0),T(i.files)):u(Ae),t.preventDefault(),t.stopPropagation(),!1}}}function I(e){if(e)return a.popups.onRefresh("image.insert",i),a.popups.onHide("image.insert",r),!0;var t,n,o="";a.opts.imageUpload||-1===a.opts.imageInsertButtons.indexOf("imageUpload")||a.opts.imageInsertButtons.splice(a.opts.imageInsertButtons.indexOf("imageUpload"),1);var s=a.button.buildList(a.opts.imageInsertButtons);""!==s&&(o='<div class="fr-buttons fr-tabs">'.concat(s,"</div>"));var l=a.opts.imageInsertButtons.indexOf("imageUpload"),p=a.opts.imageInsertButtons.indexOf("imageByURL"),f="";0<=l&&(t=" fr-active",0<=p&&p<l&&(t=""),f='<div class="fr-image-upload-layer'.concat(t,' fr-layer" id="fr-image-upload-layer-').concat(a.id,'"><strong>').concat(a.language.translate("Drop image"),"</strong><br>(").concat(a.language.translate("or click"),')<div class="fr-form"><input type="file" accept="image/').concat(a.opts.imageAllowedTypes.join(", image/").toLowerCase(),'" tabIndex="-1" aria-labelledby="fr-image-upload-layer-').concat(a.id,'" role="button"></div></div>'));var g="";0<=p&&(t=" fr-active",0<=l&&l<p&&(t=""),g='<div class="fr-image-by-url-layer'.concat(t,' fr-layer" id="fr-image-by-url-layer-').concat(a.id,'"><div class="fr-input-line"><input id="fr-image-by-url-layer-text-').concat(a.id,'" type="text" placeholder="http://" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageInsertByURL" tabIndex="2" role="button">').concat(a.language.translate("Insert"),"</button></div></div>"));var c={buttons:o,upload_layer:f,by_url_layer:g,progress_bar:'<div class="fr-image-progress-bar-layer fr-layer"><h3 tabIndex="-1" class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-dismiss" data-cmd="imageDismissError" tabIndex="2" role="button">OK</button></div></div>'};return 1<=a.opts.imageInsertButtons.length&&(n=a.popups.create("image.insert",c)),a.$wp&&a.events.$on(a.$wp,"scroll",function(){se&&a.popups.isVisible("image.insert")&&te()}),function(e){a.events.$on(e,"dragover dragenter",".fr-image-upload-layer",function(e){return de(this).addClass("fr-drop"),(a.browser.msie||a.browser.edge)&&e.preventDefault(),!1},!0),a.events.$on(e,"dragleave dragend",".fr-image-upload-layer",function(e){return de(this).removeClass("fr-drop"),(a.browser.msie||a.browser.edge)&&e.preventDefault(),!1},!0),a.events.$on(e,"drop",".fr-image-upload-layer",function(t){t.preventDefault(),t.stopPropagation(),de(this).removeClass("fr-drop");var i=t.originalEvent.dataTransfer;if(i&&i.files){var n=e.data("instance")||a;n.events.disableBlur(),n.image.upload(i.files),n.events.enableBlur()}},!0),a.helpers.isIOS()&&a.events.$on(e,"touchstart",'.fr-image-upload-layer input[type="file"]',function(){de(this).trigger("click")},!0),a.events.$on(e,"change",'.fr-image-upload-layer input[type="file"]',function(){if(this.files){var t=e.data("instance")||a;t.events.disableBlur(),e.find("input:focus").blur(),t.events.enableBlur(),t.image.upload(this.files,se)}de(this).val("")},!0)}(n),n}function z(){se&&a.popups.get("image.alt").find("input").val(se.attr("alt")||"").trigger("change")}function k(){var e=a.popups.get("image.alt");e||(e=B()),b(),a.popups.refresh("image.alt"),a.popups.setContainer("image.alt",a.$sc);var t=ne();re()&&(t=t.find(".fr-img-wrap"));var i=t.offset().left+t.outerWidth()/2,n=t.offset().top+t.outerHeight();a.popups.show("image.alt",i,n,t.outerHeight(),!0)}function B(e){if(e)return a.popups.onRefresh("image.alt",z),!0;var t={buttons:'<div class="fr-buttons fr-tabs">'.concat(a.button.buildList(a.opts.imageAltButtons),"</div>"),alt_layer:'<div class="fr-image-alt-layer fr-layer fr-active" id="fr-image-alt-layer-'.concat(a.id,'"><div class="fr-input-line"><input id="fr-image-alt-layer-text-').concat(a.id,'" type="text" placeholder="').concat(a.language.translate("Alternative Text"),'" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetAlt" tabIndex="2" role="button">').concat(a.language.translate("Update"),"</button></div></div>")},i=a.popups.create("image.alt",t);return a.$wp&&a.events.$on(a.$wp,"scroll.image-alt",function(){se&&a.popups.isVisible("image.alt")&&k()}),i}function O(){var e=a.popups.get("image.size"),t=se.get(0).style.height?se.get(0).style.height:"auto",i=se.get(0).style.width?se.get(0).style.width:"auto";if(se)if(re()){var n=se.parent();n.get(0).style.width||(n=se.parent().parent()),e.find('input[name="width"]').val(i).trigger("change"),e.find('input[name="height"]').val(t).trigger("change")}else e.find('input[name="width"]').val(i).trigger("change"),e.find('input[name="height"]').val(t).trigger("change")}function N(){var e=a.popups.get("image.size");e||(e=L()),b(),a.popups.refresh("image.size"),a.popups.setContainer("image.size",a.$sc);var t=ne();re()&&(t=t.find(".fr-img-wrap"));var i=t.offset().left+t.outerWidth()/2,n=t.offset().top+t.outerHeight();a.popups.show("image.size",i,n,t.outerHeight(),!0)}function L(e){if(e)return a.popups.onRefresh("image.size",O),!0;var t={buttons:'<div class="fr-buttons fr-tabs">'.concat(a.button.buildList(a.opts.imageSizeButtons),"</div>"),size_layer:'<div class="fr-image-size-layer fr-layer fr-active" id="fr-image-size-layer-'.concat(a.id,'"><div class="fr-image-group"><div class="fr-input-line"><input id="fr-image-size-layer-width-\'').concat(a.id,'" type="text" name="width" placeholder="').concat(a.language.translate("Width"),'" tabIndex="1"></div><div class="fr-input-line"><input id="fr-image-size-layer-height').concat(a.id,'" type="text" name="height" placeholder="').concat(a.language.translate("Height"),'" tabIndex="1"></div></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetSize" tabIndex="2" role="button">').concat(a.language.translate("Update"),"</button></div></div>")},i=a.popups.create("image.size",t);return a.$wp&&a.events.$on(a.$wp,"scroll.image-size",function(){se&&a.popups.isVisible("image.size")&&N()}),i}function _(e,t,a,i){return e.pageX=t,c.call(this,e),e.pageX=e.pageX+a*Math.floor(Math.pow(1.1,i)),d.call(this,e),m.call(this,e),++i}function M(t){(t=t||ne())&&!1!==a.events.trigger("image.beforeRemove",[t])&&(a.popups.hideAll(),ae(),q(!0),a.undo.canDo()||a.undo.saveStep(),t.get(0)==a.el?t.removeAttr("src"):(t.get(0).parentNode&&"A"==t.get(0).parentNode.tagName?(a.selection.setBefore(t.get(0).parentNode)||a.selection.setAfter(t.get(0).parentNode)||t.parent().after(e.MARKERS),de(t.get(0).parentNode).remove()):(a.selection.setBefore(t.get(0))||a.selection.setAfter(t.get(0))||t.after(e.MARKERS),t.remove()),a.html.fillEmptyBlocks(),a.selection.restore()),a.undo.saveStep())}function K(t){var i=t.which;if(se&&(i==e.KEYCODE.BACKSPACE||i==e.KEYCODE.DELETE))return t.preventDefault(),t.stopPropagation(),M(),!1;if(se&&i==e.KEYCODE.ESC){var n=se;return q(!0),a.selection.setAfter(n.get(0)),a.selection.restore(),t.preventDefault(),!1}if(!se||i!=e.KEYCODE.ARROW_LEFT&&i!=e.KEYCODE.ARROW_RIGHT)return se&&i===e.KEYCODE.TAB?(t.preventDefault(),t.stopPropagation(),q(!0),!1):se&&i!=e.KEYCODE.F10&&!a.keys.isBrowserAction(t)?(t.preventDefault(),t.stopPropagation(),!1):void 0;var r=se.get(0);return q(!0),i==e.KEYCODE.ARROW_LEFT?a.selection.setBefore(r):a.selection.setAfter(r),a.selection.restore(),t.preventDefault(),!1}function Y(e){if(e&&"IMG"==e.tagName){if(a.node.hasClass(e,"fr-uploading")||a.node.hasClass(e,"fr-error")?e.parentNode.removeChild(e):a.node.hasClass(e,"fr-draggable")&&e.classList.remove("fr-draggable"),e.parentNode&&e.parentNode.parentNode&&a.node.hasClass(e.parentNode.parentNode,"fr-img-caption")){var t=e.parentNode.parentNode;t.removeAttribute("contenteditable"),t.removeAttribute("draggable"),t.classList.remove("fr-draggable");var i=e.nextSibling;i&&i.removeAttribute("contenteditable")}}else if(e&&e.nodeType==Node.ELEMENT_NODE)for(var n=e.querySelectorAll("img.fr-uploading, img.fr-error, img.fr-draggable"),r=0;r<n.length;r++)Y(n[r])}function H(e){if(!1===a.events.trigger("image.beforePasteUpload",[e]))return!1;se=de(e),p(),n(),te(),v(),se.on("load",function(){var e=[];p(),de(a.popups.get("image.insert").get(0)).find("div.fr-active.fr-error").length<1&&v(),de(this).data("events").find(function(t){"load"===t[0]&&e.push(t)}),e.length<=1&&de(this).off("load")});for(var t=de(e).attr("src").split(","),i=atob(t[1]),r=[],o=0;o<i.length;o++)r.push(i.charCodeAt(o));T([new Blob([new Uint8Array(r)],{type:t[0].replace(/data\:/g,"").replace(/;base64/g,"")})],se)}function W(){a.opts.imagePaste?a.$el.find("img[data-fr-image-pasted]").each(function(e,t){if(a.opts.imagePasteProcess){var i=a.opts.imageDefaultWidth;i&&"auto"!=i&&(i+=a.opts.imageResizeWithPercent?"%":"px"),de(t).css("width",i).removeClass("fr-dii fr-dib fr-fir fr-fil"),Q(de(t),a.opts.imageDefaultDisplay,a.opts.imageDefaultAlign)}if(0===t.src.indexOf("data:"))H(t);else if(0===t.src.indexOf("blob:")||0===t.src.indexOf("http")&&a.opts.imageUploadRemoteUrls&&a.opts.imageCORSProxy){var n=new Image;n.crossOrigin="Anonymous",n.onload=function(){var e,i=a.o_doc.createElement("CANVAS"),n=i.getContext("2d");i.height=this.naturalHeight,i.width=this.naturalWidth,n.drawImage(this,0,0),setTimeout(function(){H(t)},0),e=2e3<this.naturalWidth||1500<this.naturalHeight?"jpeg":"png",t.src=i.toDataURL("image/".concat(e))},n.src=(0===t.src.indexOf("blob:")?"":"".concat(a.opts.imageCORSProxy,"/"))+t.src}else 0!==t.src.indexOf("http")||0===t.src.indexOf("https://mail.google.com/mail")?(a.selection.save(),de(t).remove(),a.selection.restore()):de(t).removeAttr("data-fr-image-pasted")}):a.$el.find("img[data-fr-image-pasted]").remove()}function G(e){var t=e.target.result,i=a.opts.imageDefaultWidth;i&&"auto"!=i&&(i+=a.opts.imageResizeWithPercent?"%":"px"),a.undo.saveStep(),a.html.insert('<img data-fr-image-pasted="true" src="'.concat(t,'"').concat(i?' style="width: '.concat(i,';"'):"",">"));var n=a.$el.find('img[data-fr-image-pasted="true"]');n&&Q(n,a.opts.imageDefaultDisplay,a.opts.imageDefaultAlign),a.events.trigger("paste.after")}function V(e){if(e&&e.clipboardData&&e.clipboardData.items){var t=null;if(e.clipboardData.types&&-1!=[].indexOf.call(e.clipboardData.types,"text/rtf")||e.clipboardData.getData("text/rtf"))t=e.clipboardData.items[0].getAsFile();else for(var a=0;a<e.clipboardData.items.length&&!(t=e.clipboardData.items[a].getAsFile());a++);if(t)return function(e){var t=new FileReader;t.onload=G,t.readAsDataURL(e)}(t),!1}}function X(e){return e.replace(/<img /gi,'<img data-fr-image-pasted="true" ')}function F(t){if("false"==de(this).parents("[contenteditable]").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;if(t&&"touchend"==t.type&&ce)return!0;if(t&&a.edit.isDisabled())return t.stopPropagation(),t.preventDefault(),!1;for(var i=0;i<e.INSTANCES.length;i++)e.INSTANCES[i]!=a&&e.INSTANCES[i].events.trigger("image.hideResizer");a.toolbar.disable(),t&&(t.stopPropagation(),t.preventDefault()),a.helpers.isMobile()&&(a.events.disableBlur(),a.$el.blur(),a.events.enableBlur()),a.opts.iframe&&a.size.syncIframe(),se=de(this),ae(),p(),n(),a.browser.msie?(a.popups.areVisible()&&a.events.disableBlur(),a.win.getSelection&&(a.win.getSelection().removeAllRanges(),a.win.getSelection().addRange(a.doc.createRange()))):a.selection.clear(),a.helpers.isIOS()&&(a.events.disableBlur(),a.$el.blur()),a.button.bulkRefresh(),a.events.trigger("video.hideResizer")}function q(e){se&&(Se||!0===e)&&(a.toolbar.enable(),le.removeClass("fr-active"),a.popups.hideAll(),se=null,J(),pe=null,fe&&fe.hide())}function j(){Se=!0}function J(){Se=!1}function Q(e,t,i){!a.opts.htmlUntouched&&a.opts.useClasses?(e.removeClass("fr-fil fr-fir fr-dib fr-dii"),i&&e.addClass("fr-fi".concat(i[0])),t&&e.addClass("fr-di".concat(t[0]))):"inline"==t?(e.css({display:"inline-block",verticalAlign:"bottom",margin:a.opts.imageDefaultMargin}),"center"==i?e.css({float:"none",marginBottom:"",marginTop:"",maxWidth:"calc(100% - ".concat(2*a.opts.imageDefaultMargin,"px)"),textAlign:"center"}):"left"==i?e.css({float:"left",marginLeft:0,maxWidth:"calc(100% - ".concat(a.opts.imageDefaultMargin,"px)"),textAlign:"left"}):e.css({float:"right",marginRight:0,maxWidth:"calc(100% - ".concat(a.opts.imageDefaultMargin,"px)"),textAlign:"right"})):"block"==t&&(e.css({display:"block",float:"none",verticalAlign:"top",margin:"".concat(a.opts.imageDefaultMargin,"px auto"),textAlign:"center"}),"left"==i?e.css({marginLeft:0,textAlign:"left"}):"right"==i&&e.css({marginRight:0,textAlign:"right"}))}function Z(e){if(void 0===e&&(e=ne()),e){if(e.hasClass("fr-fil"))return"left";if(e.hasClass("fr-fir"))return"right";if(e.hasClass("fr-dib")||e.hasClass("fr-dii"))return"center";var t=e.css("float");if(e.css("float","none"),"block"==e.css("display")){if(e.css("float",""),e.css("float")!=t&&e.css("float",t),0===parseInt(e.css("margin-left"),10))return"left";if(0===parseInt(e.css("margin-right"),10))return"right"}else{if(e.css("float",""),
e.css("float")!=t&&e.css("float",t),"left"==e.css("float"))return"left";if("right"==e.css("float"))return"right"}}return"center"}function ee(e){void 0===e&&(e=ne());var t=e.css("float");return e.css("float","none"),"block"==e.css("display")?(e.css("float",""),e.css("float")!=t&&e.css("float",t),"block"):(e.css("float",""),e.css("float")!=t&&e.css("float",t),"inline")}function te(){var e=a.popups.get("image.insert");e||(e=I()),a.popups.isVisible("image.insert")||(b(),a.popups.refresh("image.insert"),a.popups.setContainer("image.insert",a.$sc));var t=ne();re()&&(t=t.find(".fr-img-wrap"));var i=t.offset().left+t.outerWidth()/2,n=t.offset().top+t.outerHeight();a.popups.show("image.insert",i,n,t.outerHeight(!0),!0)}function ae(){if(se){a.events.disableBlur(),a.selection.clear();var e=a.doc.createRange();e.selectNode(se.get(0)),a.browser.msie&&e.collapse(!0),a.selection.get().addRange(e),a.events.enableBlur()}}function ie(){return se}function ne(){return re()?se.parents(".fr-img-caption").first():se}function re(){return!!se&&0<se.parents(".fr-img-caption").length}function oe(e){for(var t=document.createDocumentFragment();e.firstChild;){var a=e.removeChild(e.firstChild);t.appendChild(a)}e.parentNode.replaceChild(t,e)}var se,le,pe,fe,ge,ce,de=a.$,me="https://i.froala.com/upload",ue=!1,he=1,ve=2,be=3,ye=4,we=5,Ae=6,Ce={};Ce[he]="Image cannot be loaded from the passed link.",Ce[ve]="No link in upload response.",Ce[be]="Error during file upload.",Ce[ye]="Parsing response failed.",Ce[we]="File is too large.",Ce[Ae]="Image file type is invalid.",Ce[7]="Files can be uploaded only to same domain in IE 8 and IE 9.";var Se=!(Ce[8]="Image file is corrupted.");return{_init:function(){var t;a.events.$on(a.$el,a._mousedown,"IMG"==a.el.tagName?null:'img:not([contenteditable="false"])',function(e){if("false"==de(this).parents("contenteditable").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;a.helpers.isMobile()||a.selection.clear(),ue=!0,a.popups.areVisible()&&a.events.disableBlur(),a.browser.msie&&(a.events.disableBlur(),a.$el.attr("contenteditable",!1)),a.draggable||"touchstart"==e.type||e.preventDefault(),e.stopPropagation()}),a.events.$on(a.$el,a._mousedown,".fr-img-caption .fr-inner",function(e){a.core.hasFocus()||a.events.focus(),e.stopPropagation()}),a.events.$on(a.$el,"paste",".fr-img-caption .fr-inner",function(e){a.toolbar.hide(),e.stopPropagation()}),a.events.$on(a.$el,a._mouseup,"IMG"==a.el.tagName?null:'img:not([contenteditable="false"])',function(e){if("false"==de(this).parents("contenteditable").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;ue&&(ue=!1,e.stopPropagation(),a.browser.msie&&(a.$el.attr("contenteditable",!0),a.events.enableBlur()))}),a.events.on("keyup",function(e){if(e.shiftKey&&""===a.selection.text().replace(/\n/g,"")&&a.keys.isArrow(e.which)){var t=a.selection.element(),i=a.selection.endElement();t&&"IMG"==t.tagName?A(de(t)):i&&"IMG"==i.tagName&&A(de(i))}},!0),a.events.on("drop",P),a.events.on("element.beforeDrop",$),a.events.on("mousedown window.mousedown",j),a.events.on("window.touchmove",J),a.events.on("mouseup window.mouseup",function(){if(se)return q(),!1;J()}),a.events.on("commands.mousedown",function(e){0<e.parents(".fr-toolbar").length&&q()}),a.events.on("image.resizeEnd",function(){a.opts.iframe&&a.size.syncIframe()}),a.events.on("blur image.hideResizer commands.undo commands.redo element.dropped",function(){q(!(ue=!1))}),a.events.on("modals.hide",function(){se&&(ae(),a.selection.clear())}),a.events.on("image.resizeEnd",function(){a.win.getSelection&&A(se)}),a.opts.imageAddNewLine&&a.events.on("image.inserted",function(t){var i=t.get(0);for(i.nextSibling&&"BR"===i.nextSibling.tagName&&(i=i.nextSibling);i&&!a.node.isElement(i);)i=a.node.isLastSibling(i)?i.parentNode:null;a.node.isElement(i)&&(a.opts.enter===e.ENTER_BR?t.after("<br>"):de(a.node.blockParent(t.get(0))).after("<".concat(a.html.defaultTag(),"><br></").concat(a.html.defaultTag(),">")))}),"IMG"==a.el.tagName&&a.$el.addClass("fr-view"),a.events.$on(a.$el,a.helpers.isMobile()&&!a.helpers.isWindowsPhone()?"touchend":"click","IMG"==a.el.tagName?null:'img:not([contenteditable="false"])',F),a.helpers.isMobile()&&(a.events.$on(a.$el,"touchstart","IMG"==a.el.tagName?null:'img:not([contenteditable="false"])',function(){ce=!1}),a.events.$on(a.$el,"touchmove",function(){ce=!0})),a.$wp?(a.events.on("window.keydown keydown",K,!0),a.events.on("keyup",function(t){if(se&&t.which==e.KEYCODE.ENTER)return!1},!0),a.events.$on(a.$el,"keydown",function(){var t=a.selection.element();(t.nodeType===Node.TEXT_NODE||"BR"==t.tagName&&a.node.isLastSibling(t))&&(t=t.parentNode),a.node.hasClass(t,"fr-inner")||(a.node.hasClass(t,"fr-img-caption")||(t=de(t).parents(".fr-img-caption").get(0)),a.node.hasClass(t,"fr-img-caption")&&(de(t).after(e.INVISIBLE_SPACE+e.MARKERS),a.selection.restore()))})):a.events.$on(a.$win,"keydown",K),a.events.on("toolbar.esc",function(){if(se){if(a.$wp)a.events.disableBlur(),a.events.focus();else{var e=se;q(!0),a.selection.setAfter(e.get(0)),a.selection.restore()}return!1}},!0),a.events.on("toolbar.focusEditor",function(){if(se)return!1},!0),a.events.on("window.cut window.copy",function(t){if(se&&a.popups.isVisible("image.edit")&&!a.popups.get("image.edit").find(":focus").length){var i=ne();re()?(i.before(e.START_MARKER),i.after(e.END_MARKER),a.selection.restore(),a.paste.saveCopiedText(i.get(0).outerHTML,i.text())):(ae(),a.paste.saveCopiedText(se.get(0).outerHTML,se.attr("alt"))),"copy"==t.type?setTimeout(function(){A(se)}):(q(!0),a.undo.saveStep(),setTimeout(function(){a.undo.saveStep()},0))}},!0),a.browser.msie&&a.events.on("keydown",function(t){if(!a.selection.isCollapsed()||!se)return!0;var i=t.which;i==e.KEYCODE.C&&a.keys.ctrlKey(t)?a.events.trigger("window.copy"):i==e.KEYCODE.X&&a.keys.ctrlKey(t)&&a.events.trigger("window.cut")}),a.events.$on(de(a.o_win),"keydown",function(t){var a=t.which;if(se&&a==e.KEYCODE.BACKSPACE)return t.preventDefault(),!1}),a.events.$on(a.$win,"keydown",function(t){var a=t.which;se&&se.hasClass("fr-uploading")&&a==e.KEYCODE.ESC&&se.trigger("abortUpload")}),a.events.on("destroy",function(){se&&se.hasClass("fr-uploading")&&se.trigger("abortUpload")}),a.events.on("paste.before",V),a.events.on("paste.beforeCleanup",X),a.events.on("paste.after",W),a.events.on("html.set",s),a.events.on("html.inserted",s),s(),a.events.on("destroy",function(){ge=[]}),a.events.on("html.processGet",Y),a.opts.imageOutputSize&&a.events.on("html.beforeGet",function(){t=a.el.querySelectorAll("img");for(var e=0;e<t.length;e++){var i=t[e].style.width||de(t[e]).width(),n=t[e].style.height||de(t[e]).height();i&&t[e].setAttribute("width","".concat(i).replace(/px/,"")),n&&t[e].setAttribute("height","".concat(n).replace(/px/,""))}}),a.opts.iframe&&a.events.on("image.loaded",a.size.syncIframe),a.$wp&&(l(),a.events.on("contentChanged",l)),a.events.$on(de(a.o_win),"orientationchange.image",function(){setTimeout(function(){se&&A(se)},100)}),h(!0),I(!0),L(!0),B(!0),a.events.on("node.remove",function(e){if("IMG"==e.get(0).tagName)return M(e),!1})},showInsertPopup:function(){var e=a.$tb.find('.fr-command[data-cmd="insertImage"]'),t=a.popups.get("image.insert");if(t||(t=I()),b(),!t.hasClass("fr-active"))if(a.popups.refresh("image.insert"),a.popups.setContainer("image.insert",a.$tb),e.isVisible()){var i=a.button.getPosition(e),n=i.left,r=i.top;a.popups.show("image.insert",n,r,e.outerHeight())}else a.position.forSelection(t),a.popups.show("image.insert")},showLayer:function(e){var t,i,n=a.popups.get("image.insert");if(se||a.opts.toolbarInline){if(se){var r=ne();re()&&(r=r.find(".fr-img-wrap")),i=r.offset().top+r.outerHeight(),t=r.offset().left}}else{var o=a.$tb.find('.fr-command[data-cmd="insertImage"]');t=o.offset().left,i=o.offset().top+(a.opts.toolbarBottom?10:o.outerHeight()-10)}!se&&a.opts.toolbarInline&&(i=n.offset().top-a.helpers.getPX(n.css("margin-top")),n.hasClass("fr-above")&&(i+=n.outerHeight())),n.find(".fr-layer").removeClass("fr-active"),n.find(".fr-".concat(e,"-layer")).addClass("fr-active"),a.popups.show("image.insert",t,i,se?se.outerHeight():0),a.accessibility.focusPopup(n)},refreshUploadButton:function(e){var t=a.popups.get("image.insert");t&&t.find(".fr-image-upload-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)},refreshByURLButton:function(e){var t=a.popups.get("image.insert");t&&t.find(".fr-image-by-url-layer").hasClass("fr-active")&&e.addClass("fr-active").attr("aria-pressed",!0)},upload:T,insertByURL:function(){var e=a.popups.get("image.insert").find(".fr-image-by-url-layer input");if(0<e.val().length){v(),y(a.language.translate("Loading image"));var t=e.val().trim();if(a.opts.imageUploadRemoteUrls&&a.opts.imageCORSProxy&&a.opts.imageUpload){var i=new XMLHttpRequest;i.onload=function(){200==this.status?T([new Blob([this.response],{type:this.response.type||"image/png"})],se):u(he)},i.onerror=function(){S(t,!0,[],se)},i.open("GET","".concat(a.opts.imageCORSProxy,"/").concat(t),!0),i.responseType="blob",i.send()}else S(t,!0,[],se);e.val(""),e.blur()}},align:function(e){var t=ne();t.removeClass("fr-fir fr-fil"),!a.opts.htmlUntouched&&a.opts.useClasses?"left"==e?t.addClass("fr-fil"):"right"==e&&t.addClass("fr-fir"):Q(t,ee(),e),ae(),p(),n(),a.selection.clear()},refreshAlign:function(e){se&&e.find("> *").first().replaceWith(a.icon.create("image-align-".concat(Z())))},refreshAlignOnShow:function(e,t){se&&t.find('.fr-command[data-param1="'.concat(Z(),'"]')).addClass("fr-active").attr("aria-selected",!0)},display:function(e){var t=ne();t.removeClass("fr-dii fr-dib"),!a.opts.htmlUntouched&&a.opts.useClasses?"inline"==e?t.addClass("fr-dii"):"block"==e&&t.addClass("fr-dib"):Q(t,e,Z()),ae(),p(),n(),a.selection.clear()},refreshDisplayOnShow:function(e,t){se&&t.find('.fr-command[data-param1="'.concat(ee(),'"]')).addClass("fr-active").attr("aria-selected",!0)},replace:te,back:function(){se?(a.events.disableBlur(),de(".fr-popup input:focus").blur(),A(se)):(a.events.disableBlur(),a.selection.restore(),a.events.enableBlur(),a.popups.hide("image.insert"),a.toolbar.showInline())},get:ie,getEl:ne,insert:S,showProgressBar:v,remove:M,hideProgressBar:b,applyStyle:function(e,i,n){if(void 0===i&&(i=a.opts.imageStyles),void 0===n&&(n=a.opts.imageMultipleStyles),!se)return!1;var r=ne();if(!n){var o=Object.keys(i);o.splice(o.indexOf(e),1),r.removeClass(o.join(" "))}"object"==t(i[e])?(r.removeAttr("style"),r.css(i[e].style)):r.toggleClass(e),A(se)},showAltPopup:k,showSizePopup:N,setAlt:function(e){if(se){var t=a.popups.get("image.alt");se.attr("alt",e||t.find("input").val()||""),t.find("input:focus").blur(),A(se)}},setSize:function(e,t){if(se){var i=a.popups.get("image.size");e=e||i.find('input[name="width"]').val()||"",t=t||i.find('input[name="height"]').val()||"";var n=/^[\d]+((px)|%)*$/g;se.removeAttr("width").removeAttr("height"),e.match(n)?se.css("width",e):se.css("width",""),t.match(n)?se.css("height",t):se.css("height",""),re()&&(se.parents(".fr-img-caption").removeAttr("width").removeAttr("height"),e.match(n)?se.parents(".fr-img-caption").css("width",e):se.parents(".fr-img-caption").css("width",""),t.match(n)?se.parents(".fr-img-caption").css("height",t):se.parents(".fr-img-caption").css("height","")),i&&i.find("input:focus").blur(),A(se)}},toggleCaption:function(){var t;if(se&&!re()){(t=se).parent().is("a")&&(t=se.parent());var i,n,r=se.parents("ul")&&0<se.parents("ul").length?se.parents("ul"):se.parents("ol")&&0<se.parents("ol").length?se.parents("ol"):[];if(0<r.length){var o=r.find("li").length,s=se.parents("li"),l=document.createElement("li");o-1===s.index()&&(r.append(l),l.innerHTML="&nbsp;")}t.attr("style")?n=-1<(i=t.attr("style").split(":")).indexOf("width")?i[i.indexOf("width")+1].replace(";",""):"":t.attr("width")&&(n=t.attr("width"));var p=a.opts.imageResizeWithPercent?(-1<n.indexOf("px")?null:n)||"100%":se.width()+"px";t.wrap('<div class="fr-img-space-wrap"><span '+(a.browser.mozilla?"":'contenteditable="false"')+'class="fr-img-caption '+se.attr("class")+'" style="'+(a.opts.useClasses?"":t.attr("style"))+'" draggable="false"></span><p class="fr-img-space-wrap2">&nbsp;</p></div>'),t.wrap('<span class="fr-img-wrap"></span>'),se.after('<span class="fr-inner"'.concat(a.browser.mozilla?"":' contenteditable="true"',">").concat(e.START_MARKER).concat(a.language.translate("Image Caption")).concat(e.END_MARKER,"</span>")),se.parents(".fr-img-caption").css("width",p),1<se.parents(".fr-img-space-wrap").length&&(oe(document.querySelector(".fr-img-space-wrap")),oe(document.querySelector(".fr-img-space-wrap2"))),q(!0),a.selection.restore()}else{if(t=ne(),se.insertBefore(t),null!==t[0].querySelector("a")){for(var f,g=t[0].querySelector("a"),c=document.createElement("a"),d=0,m=g.attributes,u=m.length;d<u;d++)f=m[d],c.setAttribute(f.nodeName,f.nodeValue);se.wrap(c)}se.attr("class",t.attr("class").replace("fr-img-caption","")).attr("style",t.attr("style")),t.remove(),1<se.parents(".fr-img-space-wrap").length&&(oe(document.querySelector(".fr-img-space-wrap")),oe(document.querySelector(".fr-img-space-wrap2"))),A(se)}},hasCaption:re,exitEdit:q,edit:A}},e.DefineIcon("insertImage",{NAME:"image",SVG_KEY:"insertImage"}),e.RegisterShortcut(e.KEYCODE.P,"insertImage",null,"P"),e.RegisterCommand("insertImage",{title:"Insert Image",undo:!1,focus:!0,refreshAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("image.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("image.insert")):this.image.showInsertPopup()},plugin:"image"}),e.DefineIcon("imageUpload",{NAME:"upload",SVG_KEY:"upload"}),e.RegisterCommand("imageUpload",{title:"Upload Image",undo:!1,focus:!1,toggle:!0,callback:function(){this.image.showLayer("image-upload")},refresh:function(e){this.image.refreshUploadButton(e)}}),e.DefineIcon("imageByURL",{NAME:"link",SVG_KEY:"insertLink"}),e.RegisterCommand("imageByURL",{title:"By URL",undo:!1,focus:!1,toggle:!0,callback:function(){this.image.showLayer("image-by-url")},refresh:function(e){this.image.refreshByURLButton(e)}}),e.RegisterCommand("imageInsertByURL",{title:"Insert Image",undo:!0,refreshAfterCallback:!1,callback:function(){this.image.insertByURL()},refresh:function(e){this.image.get()?e.text(this.language.translate("Replace")):e.text(this.language.translate("Insert"))}}),e.DefineIcon("imageDisplay",{NAME:"star",SVG_KEY:"imageDisplay"}),e.RegisterCommand("imageDisplay",{title:"Display",type:"dropdown",options:{inline:"Inline",block:"Break Text"},callback:function(e,t){this.image.display(t)},refresh:function(e){this.opts.imageTextNear||e.addClass("fr-hidden")},refreshOnShow:function(e,t){this.image.refreshDisplayOnShow(e,t)}}),e.DefineIcon("image-align",{NAME:"align-left",SVG_KEY:"alignLeft"}),e.DefineIcon("image-align-left",{NAME:"align-left",SVG_KEY:"alignLeft"}),e.DefineIcon("image-align-right",{NAME:"align-right",SVG_KEY:"alignRight"}),e.DefineIcon("image-align-center",{NAME:"align-justify",SVG_KEY:"alignCenter"}),e.DefineIcon("imageAlign",{NAME:"align-justify",SVG_KEY:"alignJustify"}),e.RegisterCommand("imageAlign",{type:"dropdown",title:"Align",options:{left:"Align Left",center:"None",right:"Align Right"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.COMMANDS.imageAlign.options;for(var i in a)a.hasOwnProperty(i)&&(t+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="imageAlign" data-param1="'.concat(i,'" title="').concat(this.language.translate(a[i]),'">').concat(this.icon.create("image-align-".concat(i)),'<span class="fr-sr-only">').concat(this.language.translate(a[i]),"</span></a></li>"));return t+"</ul>"},callback:function(e,t){this.image.align(t)},refresh:function(e){this.image.refreshAlign(e)},refreshOnShow:function(e,t){this.image.refreshAlignOnShow(e,t)}}),e.DefineIcon("imageReplace",{NAME:"exchange",FA5NAME:"exchange-alt",SVG_KEY:"replaceImage"}),e.RegisterCommand("imageReplace",{title:"Replace",undo:!1,focus:!1,popup:!0,refreshAfterCallback:!1,callback:function(){this.image.replace()}}),e.DefineIcon("imageRemove",{NAME:"trash",SVG_KEY:"remove"}),e.RegisterCommand("imageRemove",{title:"Remove",callback:function(){this.image.remove()}}),e.DefineIcon("imageBack",{NAME:"arrow-left",SVG_KEY:"back"}),e.RegisterCommand("imageBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.image.back()},refresh:function(e){this.$,this.image.get()||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),e.RegisterCommand("imageDismissError",{title:"OK",undo:!1,callback:function(){this.image.hideProgressBar(!0)}}),e.DefineIcon("imageStyle",{NAME:"magic",SVG_KEY:"imageClass"}),e.RegisterCommand("imageStyle",{title:"Style",type:"dropdown",html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',a=this.opts.imageStyles;for(var i in a)if(a.hasOwnProperty(i)){var n=a[i];"object"==t(n)&&(n=n.title),e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="imageStyle" data-param1="'.concat(i,'">').concat(this.language.translate(n),"</a></li>")}return e+"</ul>"},callback:function(e,t){this.image.applyStyle(t)},refreshOnShow:function(e,t){var a=this.$,i=this.image.getEl();i&&t.find(".fr-command").each(function(){var e=a(this).data("param1"),t=i.hasClass(e);a(this).toggleClass("fr-active",t).attr("aria-selected",t)})}}),e.DefineIcon("imageAlt",{NAME:"info",SVG_KEY:"imageAltText"}),e.RegisterCommand("imageAlt",{undo:!1,focus:!1,popup:!0,title:"Alternative Text",callback:function(){this.image.showAltPopup()}}),e.RegisterCommand("imageSetAlt",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setAlt()}}),e.DefineIcon("imageSize",{NAME:"arrows-alt",SVG_KEY:"imageSize"}),e.RegisterCommand("imageSize",{undo:!1,focus:!1,popup:!0,title:"Change Size",callback:function(){this.image.showSizePopup()}}),e.RegisterCommand("imageSetSize",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setSize()}}),e.DefineIcon("imageCaption",{NAME:"commenting",FA5NAME:"comment-alt",SVG_KEY:"imageCaption"}),e.RegisterCommand("imageCaption",{undo:!0,focus:!1,title:"Image Caption",refreshAfterCallback:!0,callback:function(){this.image.toggleCaption()},refresh:function(e){this.image.get()&&e.toggleClass("fr-active",this.image.hasCaption())}})});